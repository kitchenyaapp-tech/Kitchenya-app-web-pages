<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</title>

<!-- Supabase v2 -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Segoe UI,Tahoma;
  background:linear-gradient(135deg,#f5f5f5,#fff);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:16px;
  box-shadow:0 8px 32px rgba(0,0,0,.1);
  overflow:hidden;
}
.header{
  background:linear-gradient(135deg,#c4986d,#b8885f);
  padding:35px;
  text-align:center;
  color:#fff;
}
.form{
  padding:30px;
}
label{display:block;margin-bottom:8px;font-weight:500}
input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:2px solid #e0e0e0;
  margin-bottom:18px;
  font-size:15px;
}
input:focus{
  outline:none;
  border-color:#c4986d;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  background:linear-gradient(135deg,#c4986d,#b8885f);
  color:#fff;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}
button:disabled{opacity:.6}
.message{
  display:none;
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
  text-align:center;
  font-size:14px;
}
.message.error{
  display:block;
  background:#f8d7da;
  color:#721c24;
}
.message.success{
  display:block;
  background:#d4edda;
  color:#155724;
}
</style>
</head>

<body>

<div class="container">
  <div class="header">
    <h2>ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
    <p>Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
  </div>

  <div class="form">
    <div id="message" class="message"></div>

    <form id="passwordForm">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
      <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©">

      <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input type="password" id="confirm" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

      <button id="submitBtn">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
    </form>
  </div>
</div>


<script>
/* ================= Ø¥Ø¹Ø¯Ø§Ø¯ Supabase ================= */
const SUPABASE_URL = "https://vocscobrhvvmqzvgsqru.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvY3Njb2JyaHZ2bXF6dmdzcXJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMDAwNjYsImV4cCI6MjA3NzU3NjA2Nn0.1WlABxMg73R6MGcU6AzSZ5Ks4ssiRhNeeEBD_A6pNo0";

const supabaseClient = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);
const code = '021895c7-4807-4ff2-bab9-79e021c1a817';

const { data, error } = await supabaseClient.auth.exchangeCodeForSession(code);
console.log(data);
function showMessage(text, type) {
  const el = document.getElementById("message");
  el.textContent = text;
  el.className = "message " + type;
}

function setLoading(isLoading) {
  const btn = document.getElementById("submitBtn");
  btn.disabled = isLoading;
  btn.textContent = isLoading ? "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©..." : "ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±";
}

/* ================= ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ session ================= */
async function initRecovery() {
  try {
    const params = new URLSearchParams(window.location.search);
    const code = params.get("code"); // Ù‡Ù†Ø§ Ù†Ø§Ø®Ø° ÙÙ‚Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒÙˆØ¯

    if (!code) {
      showMessage("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ ØµØ§Ù„Ø­ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·", "error");
      return;
    }
    
    console.log(code);
    const { data, error } = await supabaseClient.auth.exchangeCodeForSession(code);

    if (error) {
      console.error(error);
      showMessage("âŒ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ", "error");
    } else {
      console.log("âœ… Session Ø¬Ø§Ù‡Ø²:", data);
    }
  } catch (err) {
    console.error(err);
    showMessage("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹", "error");
  }
}

initRecovery();

/* ================= Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ================= */
document.getElementById("passwordForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const password = document.getElementById("password").value.trim();
  const confirm = document.getElementById("confirm").value.trim();

  if (!password || !confirm) {
    showMessage("Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©", "error");
    return;
  }

  if (password.length < 6) {
    showMessage("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "error");
    return;
  }

  if (password !== confirm) {
    showMessage("ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†", "error");
    return;
  }

  setLoading(true);

  try {
    const { error } = await supabaseClient.auth.updateUser({
      password: password
    });

    if (error) {
      console.error(error);
      showMessage("âŒ " + error.message, "error");
      setLoading(false);
      return;
    }

    showMessage("âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­", "success");
    document.getElementById("passwordForm").reset();
  } catch (err) {
    console.error(err);
    showMessage("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹", "error");
  }

  setLoading(false);
});
</script>


</body>
</html>
